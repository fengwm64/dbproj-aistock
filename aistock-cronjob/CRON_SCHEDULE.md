# AI Stock 定时任务详细配置说明

## 📋 定时任务列表

### 高频任务（分钟级）

| 任务 | 频率 | 时间 | 脚本 | 说明 |
|------|------|------|------|------|
| 获取市场指数 | 每10秒 | 持续 | `get_index.py` | 实时获取主要市场指数数据 |
| 获取新闻 | 每10分钟 | `*/10 * * * *` | `get_news.py` | 获取最新股票相关新闻 |
| 获取实时行情 | 每10分钟 | `*/10 * * * *` | `get_realtime_quotes.py` | 获取股票实时行情数据 |
| 获取热门股票 | 每30分钟 | `*/30 * * * *` | `get_hot_stock.py` | 获取热门股票榜单 |

### 中频任务（小时级）

| 任务 | 频率 | 时间 | 脚本 | 说明 |
|------|------|------|------|------|
| 获取标签股票 | 每60分钟 | `0 * * * *` | `get_tags_stocks.py` | 获取各类标签对应的股票 |
| 更新个股新闻 | 每1小时30分 | `30 */1 * * *` | `get_stock_news.py` | 更新个股相关新闻 |

### 日常任务（每日执行）

| 任务 | 时间 | 脚本 | 说明 |
|------|------|------|------|
| 获取历史行情 | 00:00 | `get_stock_history.py` | 获取股票历史价格数据 |
| AI评测 | 00:30 | `get_stock_eva.py` | 更新个股AI评测 |
| 获取股票列表 | 02:30 | `get_stock_name.py` | 获取股票基础信息列表 |
| 重启服务器 | 06:30 | `reboot` | 每日重启服务器 |
| 早晨推送 | 09:30 | `wechat_push_morning.py` | 发送股票晨报推送 |
| AI评测 | 09:30 | `get_stock_eva.py` | 开盘前AI评测 |
| AI评测 | 14:30 | `get_stock_eva.py` | 午后AI评测 |
| AI评测 | 18:30 | `get_stock_eva.py` | 收盘后AI评测 |
| 获取股票信息 | 22:30 | `get_stock_info.py` | 获取股票基本面信息 |

### 交易时段推送

| 时间 | 脚本 | 说明 |
|------|------|------|
| 10:00-16:00 | `wechat_push.py` | 交易时段每小时推送 |

具体时间：10:00、11:00、12:00、13:00、14:00、15:00、16:00

### 定期维护

| 任务 | 频率 | 时间 | 说明 |
|------|------|------|------|
| 缓存清理 | 每周一 | 00:00 | 清理Redis缓存 |
| 数据库备份 | 每 3 天 | 06:00 | mysqldump 导出数据库 |

## 🔧 Cron 表达式说明

### 基本格式
```
分钟 小时 日 月 星期 用户 命令
```

### 特殊符号
- `*` : 任意值
- `*/n` : 每n个时间单位
- `n,m` : 指定多个值
- `n-m` : 指定范围

### 示例解释
```bash
# 每10分钟执行
*/10 * * * *

# 每小时的第30分钟执行
30 * * * *

# 每天上午9点30分执行
30 9 * * *

# 每周一凌晨0点执行
0 0 * * 1

# 每天10点到16点的整点执行
0 10,11,12,13,14,15,16 * * *
```

## 📊 任务优先级和资源分配

### 高优先级任务
- 获取市场指数（每10秒）
- 获取实时行情（每10分钟）
- 获取新闻（每10分钟）

### 中优先级任务
- 获取热门股票（每30分钟）
- 获取标签股票（每60分钟）
- 定时推送（交易时段）

### 低优先级任务
- 获取历史数据（每日）
- AI评测（每日）
- 基础信息更新（每日）

## ⚠️ 注意事项

### 1. 系统重启
- 每日06:30自动重启服务器
- 重启前会保存当前状态
- 重启后自动恢复所有服务

### 2. 资源管理
- 高频任务可能消耗较多CPU和网络资源
- 建议在高峰期适当调整频率
- 监控系统资源使用情况

### 3. 错误处理
- 所有任务都有错误日志记录
- 定期检查日志文件
- 失败任务会在下次调度时重试

### 4. 数据一致性
- AI评测任务在多个时间点执行
- 确保数据更新的时序性
- 避免并发写入冲突

### 5. 网络依赖
- 大部分任务依赖外部API
- 网络异常时任务会失败
- 建议配置重试机制

## 🔍 监控建议

### 关键指标
- 任务执行成功率
- 任务执行耗时
- 系统资源使用率
- 数据更新及时性

### 告警规则
- 连续失败超过3次
- 执行时间超过预期
- 系统资源超过阈值
- 数据更新延迟

### 日志分析
```bash
# 查看任务执行统计
grep "成功" /var/log/cron/*.log | wc -l

# 查看错误统计
grep "错误\|失败" /var/log/cron/*.log | wc -l

# 查看最近的执行情况
tail -100 /var/log/cron/*.log
```

## 🚀 性能优化建议

### 1. 任务调度优化
- 避免同时执行过多任务
- 错峰执行资源密集型任务
- 合理设置任务间隔

### 2. 数据库优化
- 使用连接池
- 批量操作
- 索引优化

### 3. 缓存策略
- 合理使用Redis缓存
- 定期清理过期数据
- 避免缓存穿透

### 4. 网络优化
- 设置合理的超时时间
- 使用连接复用
- 实现重试机制
